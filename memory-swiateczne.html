<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Świąteczne Memory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background: radial-gradient(ellipse at center, #b60000 0%, #750000 100%);
      color: #ffffff;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: padding-top 0.3s ease;
    }

    body.fullscreen-active {
      padding-top: 120px;
      overflow: visible;
    }

    #game-title {
      text-align: center;
      font-size: 64px;
      margin-bottom: 20px;
      font-weight: bold;
      letter-spacing: 4px;
      text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
    }

    .config-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      margin-bottom: 20px;
      font-size: 0.9rem;
      transform: scale(0.94);
      margin-left: auto;
      margin-right: auto;
    }

    .left-block, .right-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .team-input {
      width: 240px;
      text-align: center;
    }

    .team-input label {
      font-size: 20px;
      display: block;
      margin-bottom: 4px;
    }

    .team-input input {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      outline: none;
    }

    .section-title {
      font-size: 20px;
      margin: 24px 0 10px;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-left: auto;
      margin-right: auto;
    }

    .button-group button {
      width: 150px;
      height: 44px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      background-color: #104f9c;
      color: white;
      border: 4px solid white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      text-transform: none;
      transition: background-color 0.3s ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .button-group button.active {
      background-color: #2e7d32 !important;
    }

    #noTeamsBtn {
      width: 312px;
      height: 44px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      background-color: #104f9c;
      color: white;
      border: 4px solid white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      text-transform: none;
      margin-top: 12px;
    }

    #noTeamsBtn.active {
      background-color: #2e7d32 !important;
    }

    #nextBtn, #configFullscreenBtn, #instructionsBtn, #instructionsReturnBtn, #congratsReturnBtn {
      width: 240px;
      height: 52px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      background-color: #104f9c;
      color: white;
      border: 4px solid white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      text-transform: capitalize;
    }

    #nextBtn {
      background-color: #2e7d32;
    }

    #config-buttons {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      margin-bottom: 30px;
      margin-left: auto;
      margin-right: auto;
      justify-content: center;
    }

    #nextBtn-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    #instructions-screen, #congratulations-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      max-width: 800px;
      margin: 0 auto;
    }

    #instructions-text, #winner-text, #score-text {
      font-size: 17px;
      line-height: 1.5;
      text-align: justify;
      margin-bottom: 20px;
      white-space: pre-wrap;
    }

    #congrats-title {
      font-size: 80px;
      font-weight: bold;
      margin-bottom: 20px;
      text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
      color: #104f9c;
      -webkit-text-stroke: 2px white;
      text-stroke: 2px white;
    }

    #game-container {
      display: none;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      flex-wrap: wrap;
    }

    .scoreboard {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-size: 34px;
      font-weight: bold;
      margin-top: 0;
      margin-bottom: 10px;
      width: 240px;
    }

    .scoreboard div {
      margin: 10px 0;
    }

    #full-grid {
      display: grid;
      grid-template-columns: repeat(8, auto);
      grid-template-rows: repeat(7, auto);
      gap: 0.5vw;
    }

    .grid-cell {
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: clamp(14px, 1.8vw, 20px);
      color: white;
      opacity: 1;
      transition: opacity 0.4s ease;
    }

    .grid-cell.ukryj-oznakowanie {
      opacity: 0;
    }

    .card {
      width: clamp(60px, 10vw, 100px);
      aspect-ratio: 1 / 1;
      position: relative;
      cursor: pointer;
      border-radius: 12px;
      overflow: hidden;
    }

    .card .front {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
      visibility: hidden;
      transition: filter 1s ease;
    }

    .card .cover {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
      transition: filter 0.3s ease;
      z-index: 2;
      visibility: visible;
      filter: grayscale(100%) brightness(80%);
    }

    .cover.kolorowa {
      filter: none;
    }

    .card.flipped .cover {
      visibility: hidden;
    }

    .card.flipped .front {
      visibility: visible;
    }

    .card.matched .front {
      filter: grayscale(100%) brightness(60%);
    }

    #buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }

    #buttons button {
      width: 240px;
      padding: 15px 20px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      background-color: #104f9c;
      color: white;
      border: 4px solid white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      margin-bottom: 10px;
    }

    #startBtn {
      background-color: #2e7d32 !important;
    }

    #buttons img {
      width: 150px;
      height: auto;
      display: block;
      margin-top: 10px;
    }

    #logo {
      width: 150px;
      height: auto;
      margin-left: auto;
      margin-right: auto;
      display: block;
    }

    #website-link {
      color: white;
      font-size: 14px;
      margin-top: 10px;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }

    .team-name {
      font-size: 34px;
      font-weight: bold;
      color: white;
      width: 240px;
      height: 48px;
      line-height: 48px;
      padding: 0 8px;
      text-align: left;
      white-space: pre;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }

    .team-name.active {
      background-color: #104f9c;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .time-label {
      font-size: 15px;
      color: white;
      text-align: left;
      margin-bottom: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .time-display {
      width: 160px;
      height: 36px;
      line-height: 36px;
      padding: 0 8px;
      font-size: 15px;
      font-weight: bold;
      text-align: center;
      background-color: #104f9c;
      color: white;
      border: 4px solid white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .current-team-display {
      display: none;
    }

    @media (max-width: 768px) {
      .config-container {
        flex-direction: column;
        align-items: center;
        transform: scale(1);
        width: 100%;
        max-width: 340px;
      }

      .left-block, .right-block {
        width: 100%;
        max-width: 340px;
        align-items: center;
      }

      .team-input {
        width: 100%;
        max-width: 340px;
      }

      .button-group {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        width: 100%;
        max-width: 340px;
        justify-items: center;
      }

      .button-group button {
        width: 100%;
        max-width: 140px;
      }

      #noTeamsBtn {
        width: 292px;
        max-width: 292px;
      }

      .section-title {
        width: 100%;
        max-width: 340px;
      }

      #config-buttons {
        width: 100%;
        max-width: 340px;
        justify-content: center;
      }

      #nextBtn-container {
        width: 100%;
        max-width: 340px;
      }

      #instructions-screen, #congratulations-screen {
        width: 100%;
        max-width: 800px;
      }

      #congrats-title {
        font-size: 48px;
        -webkit-text-stroke: 1.5px white;
        text-stroke: 1.5px white;
      }

      #logo {
        width: 150px;
        max-width: 340px;
      }

      #website-link {
        width: 100%;
        max-width: 340px;
      }

      #configFullscreenBtn {
        display: none;
      }
    }
  </style>
</head>
<body>
  <h1 id="game-title">Świąteczne Memory</h1>
  <div id="config-buttons">
    <button id="instructionsBtn">Instrukcja</button>
    <button id="configFullscreenBtn">Pełny ekran</button>
  </div>

  <div id="config-screen">
    <div class="config-container">
      <div class="left-block">
        <div class="team-input">
          <label for="team1">Nazwa drużyny nr 1</label>
          <input type="text" id="team1" maxlength="13" placeholder="Wpisz nazwę" />
        </div>
        <div class="team-input" style="margin-top: 24px;">
          <label for="team2">Nazwa drużyny nr 2</label>
          <input type="text" id="team2" maxlength="13" placeholder="Wpisz nazwę" />
        </div>
      </div>

      <div class="right-block" style="margin-top: -24px;">
        <div class="section-title">Która drużyna ma rozpocząć grę?</div>
        <div class="button-group" id="starterGroup">
          <button id="btnTeam1">Drużyna 1</button>
          <button id="btnTeam2">Drużyna 2</button>
        </div>
        <button id="noTeamsBtn">Gra bez podziału na drużyny</button>
      </div>
    </div>

    <div class="section-title">Czas na wykonanie ruchu drużyny:</div>
    <div class="button-group" id="moveTimeGroup">
      <button data-time="15">15 sek.</button>
      <button data-time="30">30 sek.</button>
      <button data-time="60">60 sek.</button>
      <button data-time="0">Bez czasu</button>
    </div>

    <div class="section-title" style="margin-top: 40px;">Czas na całą rozgrywkę:</div>
    <div class="button-group" id="gameTimeGroup">
      <button data-time="15">15 min.</button>
      <button data-time="25">25 min.</button>
      <button data-time="35">35 min.</button>
      <button data-time="0">Bez czasu</button>
    </div>

    <div id="nextBtn-container">
      <button id="nextBtn">Dalej</button>
    </div>

    <img id="logo" src="memory/logo.png" alt="Logo" />
    <div id="website-link">WWW.MUZYKAMIKROFONACKJA.PL</div>
  </div>

  <div id="instructions-screen">
    <div id="instructions-text">
Gra oparta jest na klasycznych zasadach Memory. Uczestnicy dzielą się na dwie drużyny, które na zmianę odkrywają po dwa kafelki. Jeżeli drużynie uda się odsłonić dwa takie same obrazki, to ta para zostaje odkryta na stałe, a drużyna zdobywa jeden punkt i ma prawo wykonać kolejny ruch.

W przypadku odkrycia dwóch różnych kafelków są one ponownie zakrywane, a kolejka przechodzi na drużynę przeciwną. Łącznie w grze znajdują się 42 kafelki, czyli 21 par do odnalezienia i tyle samo punktów do zdobycia.

Przed rozpoczęciem gry należy w odpowiednich polach wpisać nazwy obu drużyn oraz wybrać, która z nich jako pierwsza będzie odkrywać kafelki. W tych samych ustawieniach można również ustalić czas na całą rozgrywkę lub czas na ruch każdej z drużyn. Do wyboru jest kilka wariantów czasowych oraz opcja grania bez czasu.

Po przekroczeniu czasu na całą rozgrywkę, wygrywa drużyna, która zdobyła więcej punktów (nawet jeśli wszystkie kafelki nie zostały odkryte). W przypadku przekroczenia czasu przeznaczonego na ruch drużyny, kolejka automatycznie przechodzi na drużynę przeciwną.

Istnieje również wariant gry bez rywalizacji i podziału na drużyny. W takim przypadku można grać indywidualnie lub współpracując z całą grupą, starając się wspólnie odkryć wszystkie pary, zarówno w wersji z określonym czasem jak i bez. To doskonały sposób na integrację i wspólne ćwiczenie pamięci.

Życzymy dobrej zabawy!
    </div>
    <button id="instructionsReturnBtn">Powrót</button>
    <img id="logo" src="memory/logo.png" alt="Logo" />
    <div id="website-link">WWW.MUZYKAMIKROFONACKJA.PL</div>
  </div>

  <div id="congratulations-screen">
    <h2 id="congrats-title">GRATULACJE!!!</h2>
    <div id="winner-text"></div>
    <div id="score-text"></div>
    <button id="congratsReturnBtn">Powrót</button>
    <img id="logo" src="memory/logo.png" alt="Logo" />
    <div id="website-link">WWW.MUZYKAMIKROFONACKJA.PL</div>
  </div>

  <div id="game-container">
    <div id="full-grid"></div>

    <div style="display: flex; flex-direction: column; align-items: center;">
      <div class="scoreboard">
        <div id="team1-label" class="team-name"><span id="team1-name"></span>:  <span id="score1">0</span></div>
        <div id="team2-label" class="team-name"><span id="team2-name"></span>:  <span id="score2">0</span></div>
        <div id="current-team" class="current-team-display"></div>
        <div class="time-label" id="moveTimeLabel">
          Czas na ruch:
          <span id="moveTimeDisplay" class="time-display">Bez czasu</span>
        </div>
        <div class="time-label" id="gameTimeLabel">
          Czas na rozgrywkę:
          <span id="gameTimeDisplay" class="time-display">Bez czasu</span>
        </div>
      </div>

      <div id="buttons" class="controls">
        <button id="startBtn">Start</button>
        <button id="fullscreenBtn">Pełny ekran</button>
        <button id="returnBtn">Powrót</button>
        <img src="memory/logo.png" alt="Logo" />
        <div id="website-link">WWW.MUZYKAMIKROFONACKJA.PL</div>
      </div>
    </div>
  </div>

  <script>
    // Elementy ekranu konfiguracyjnego
    const configScreen = document.getElementById("config-screen");
    const team1Input = document.getElementById("team1");
    const team2Input = document.getElementById("team2");
    const btnTeam1 = document.getElementById("btnTeam1");
    const btnTeam2 = document.getElementById("btnTeam2");
    const noTeamsBtn = document.getElementById("noTeamsBtn");
    const moveTimeGroup = document.getElementById("moveTimeGroup");
    const gameTimeGroup = document.getElementById("gameTimeGroup");
    const nextBtn = document.getElementById("nextBtn");
    const configFullscreenBtn = document.getElementById("configFullscreenBtn");
    const instructionsBtn = document.getElementById("instructionsBtn");

    // Elementy ekranu instrukcji
    const instructionsScreen = document.getElementById("instructions-screen");
    const instructionsReturnBtn = document.getElementById("instructionsReturnBtn");

    // Elementy ekranu gratulacji
    const congratulationsScreen = document.getElementById("congratulations-screen");
    const congratsReturnBtn = document.getElementById("congratsReturnBtn");
    const winnerText = document.getElementById("winner-text");
    const scoreText = document.getElementById("score-text");

    // Elementy ekranu gry
    const gameContainer = document.getElementById("game-container");
    const fullGrid = document.getElementById("full-grid");
    const startBtn = document.getElementById("startBtn");
    const score1 = document.getElementById("score1");
    const score2 = document.getElementById("score2");
    const fullscreenBtn = document.getElementById("fullscreenBtn");
    const moveTimeDisplay = document.getElementById("moveTimeDisplay");
    const gameTimeDisplay = document.getElementById("gameTimeDisplay");
    const moveTimeLabel = document.getElementById("moveTimeLabel");
    const gameTimeLabel = document.getElementById("gameTimeLabel");
    const currentTeamDisplay = document.getElementById("current-team");
    const team1Label = document.getElementById("team1-label");
    const team2Label = document.getElementById("team2-label");
    const team1NameSpan = document.getElementById("team1-name");
    const team2NameSpan = document.getElementById("team2-name");
    const returnBtn = document.getElementById("returnBtn");

    // Zmienne konfiguracyjne
    let team1Name = "Drużyna 1";
    let team2Name = "Drużyna 2";
    let startingTeam = null;
    let moveTime = null;
    let gameTime = null;
    let noTeamsMode = false;

    // Zmienne gry
    let firstCard = null;
    let secondCard = null;
    let lockBoard = true;
    let matchedPairs = 0;
    let moveTimer;
    let gameTimer;
    let moveSeconds = 0;
    let gameSeconds = 0;
    let started = false;
    let points1 = 0;
    let points2 = 0;
    let currentTeam = null;
    let cards = [];

    // Funkcje konfiguracyjne
    const updateButtonLabels = () => {
      btnTeam1.textContent = (team1Input.value.trim() || "Drużyna 1");
      btnTeam2.textContent = (team2Input.value.trim() || "Drużyna 2");
    };

    const activateSingleButton = (group, value, setCallback) => {
      [...group.querySelectorAll("button")].forEach(btn => {
        btn.classList.toggle("active", btn.dataset.time == value);
      });
      setCallback(value);
    };

    team1Input.addEventListener("input", updateButtonLabels);
    team2Input.addEventListener("input", updateButtonLabels);

    btnTeam1.addEventListener("click", () => {
      if (!noTeamsMode) {
        startingTeam = 1;
        btnTeam1.classList.add("active");
        btnTeam2.classList.remove("active");
      }
    });

    btnTeam2.addEventListener("click", () => {
      if (!noTeamsMode) {
        startingTeam = 2;
        btnTeam2.classList.add("active");
        btnTeam1.classList.remove("active");
      }
    });

    noTeamsBtn.addEventListener("click", () => {
      noTeamsMode = !noTeamsMode;
      noTeamsBtn.classList.toggle("active", noTeamsMode);
      team2Input.disabled = noTeamsMode;
      team2Input.style.opacity = noTeamsMode ? 0.5 : 1;
      btnTeam1.disabled = noTeamsMode;
      btnTeam2.disabled = noTeamsMode;
      btnTeam1.style.opacity = noTeamsMode ? 0.5 : 1;
      btnTeam2.style.opacity = noTeamsMode ? 0.5 : 1;
      moveTimeGroup.querySelectorAll("button").forEach(btn => {
        btn.disabled = noTeamsMode;
        btn.style.opacity = noTeamsMode ? 0.5 : 1;
      });
      if (noTeamsMode) {
        startingTeam = null;
        moveTime = 0;
        btnTeam1.classList.remove("active");
        btnTeam2.classList.remove("active");
        moveTimeGroup.querySelectorAll("button").forEach(btn => btn.classList.remove("active"));
      }
    });

    moveTimeGroup.addEventListener("click", e => {
      if (e.target.tagName === "BUTTON" && !noTeamsMode) {
        activateSingleButton(moveTimeGroup, e.target.dataset.time, val => moveTime = parseInt(val));
      }
    });

    gameTimeGroup.addEventListener("click", e => {
      if (e.target.tagName === "BUTTON") {
        activateSingleButton(gameTimeGroup, e.target.dataset.time, val => gameTime = parseInt(val));
      }
    });

    // Funkcje gry
    const formatTime = (seconds) => {
      if (isNaN(seconds) || seconds < 0) {
        console.error("Invalid seconds value in formatTime:", seconds);
        return "00:00";
      }
      const mins = Math.floor(seconds / 60).toString().padStart(2, "0");
      const secs = (seconds % 60).toString().padStart(2, "0");
      return `${mins}:${secs}`;
    };

    const updateTeamHighlight = () => {
      team1Label.classList.remove("active");
      team2Label.classList.remove("active");
      if (!noTeamsMode && currentTeam === 1) {
        team1Label.classList.add("active");
      } else if (!noTeamsMode && currentTeam === 2) {
        team2Label.classList.add("active");
      }
    };

    const updateCurrentTeamDisplay = () => {
      if (!currentTeam || noTeamsMode) {
        currentTeamDisplay.textContent = "";
        return;
      }
      const teamName = currentTeam === 1 ? team1Name : team2Name;
      const points = currentTeam === 1 ? points1 : points2;
      currentTeamDisplay.textContent = `${teamName}: ${points}`;
    };

    const createBoard = (colorCovers = false) => {
      try {
        fullGrid.innerHTML = "";
        cards = [];

        const totalPairs = 21;
        const all = [];
        for (let i = 1; i <= totalPairs; i++) {
          all.push(i, i);
        }
        const shuffled = all.sort(() => 0.5 - Math.random());

        const letters = ["", "A", "B", "C", "D", "E", "F", "G"];
        const rows = ["", "1", "2", "3", "4", "5", "6"];

        for (let i = 0; i < 7; i++) {
          for (let j = 0; j < 8; j++) {
            const cell = document.createElement("div");

            if (i === 0 && j > 0) {
              cell.classList.add("grid-cell", "label-cell", "ukryj-oznakowanie");
              cell.textContent = letters[j];
            } else if (j === 0 && i > 0) {
              cell.classList.add("grid-cell", "label-cell", "ukryj-oznakowanie");
              cell.textContent = rows[i];
            } else if (i > 0 && j > 0) {
              if (!shuffled.length) {
                console.error("Not enough values in shuffled array");
                return;
              }
              const value = shuffled.pop();
              const card = document.createElement("div");
              card.classList.add("card");

              const frontImg = document.createElement("img");
              frontImg.src = `memory/${value}.png`;
              frontImg.classList.add("front");

              const backImg = document.createElement("img");
              backImg.src = "memory/0.png";
              backImg.classList.add("cover");
              if (colorCovers) backImg.classList.add("kolorowa");

              card.appendChild(frontImg);
              card.appendChild(backImg);
              card.addEventListener("click", () => handleCardClick(card, value));
              cell.appendChild(card);
              cards.push(card);
            }

            fullGrid.appendChild(cell);
          }
        }
      } catch (error) {
        console.error("Error in createBoard:", error);
      }
    };

    const handleCardClick = (card, value) => {
      if (lockBoard || card.classList.contains("flipped") || card.classList.contains("matched") || !started) return;

      card.classList.add("flipped");

      if (!firstCard) {
        firstCard = { card, value };
        if (!noTeamsMode && moveTime > 0 && !moveTimer) {
          moveSeconds = moveTime;
          moveTimeDisplay.textContent = formatTime(moveSeconds);
          startMoveTimer();
        }
      } else {
        secondCard = { card, value };
        lockBoard = true;

        if (firstCard.value === secondCard.value) {
          firstCard.card.classList.add("matched");
          secondCard.card.classList.add("matched");

          matchedPairs++;
          points1++;
          score1.textContent = points1;
          if (!noTeamsMode && currentTeam === 2) {
            points2++;
            score2.textContent = points2;
          }
          updateCurrentTeamDisplay();

          if (matchedPairs === 21) {
            clearInterval(moveTimer);
            clearInterval(gameTimer);
            showCongratulationsScreen();
            return;
          }

          if (!noTeamsMode && moveTime > 0) {
            clearInterval(moveTimer);
            moveTimer = null;
            moveSeconds = moveTime;
            moveTimeDisplay.textContent = formatTime(moveSeconds);
            startMoveTimer();
          } else {
            moveTimeDisplay.textContent = "Bez czasu";
          }
          resetTurn();
        } else {
          if (!noTeamsMode && moveTime > 0) {
            clearInterval(moveTimer);
            moveTimer = null;
            moveSeconds = moveTime;
            moveTimeDisplay.textContent = formatTime(moveSeconds);
          } else {
            moveTimeDisplay.textContent = "Bez czasu";
          }
          setTimeout(() => {
            firstCard.card.classList.remove("flipped");
            secondCard.card.classList.remove("flipped");
            resetTurn();
            if (!noTeamsMode) {
              currentTeam = currentTeam === 1 ? 2 : 1;
              updateTeamHighlight();
              updateCurrentTeamDisplay();
              if (moveTime > 0) {
                startMoveTimer();
              }
            }
          }, 1000);
        }
      }
    };

    const resetTurn = () => {
      firstCard = null;
      secondCard = null;
      lockBoard = false;
    };

    const startMoveTimer = () => {
      if (!noTeamsMode && moveTime > 0) {
        moveTimer = setInterval(() => {
          moveSeconds--;
          moveTimeDisplay.textContent = formatTime(moveSeconds);
          if (moveSeconds <= 0) {
            clearInterval(moveTimer);
            moveTimer = null;
            if (firstCard && !secondCard) {
              firstCard.card.classList.remove("flipped");
              resetTurn();
            }
            currentTeam = currentTeam === 1 ? 2 : 1;
            updateTeamHighlight();
            updateCurrentTeamDisplay();
            moveSeconds = moveTime;
            moveTimeDisplay.textContent = formatTime(moveSeconds);
            startMoveTimer();
          }
        }, 1000);
      }
    };

    const startGameTimer = () => {
      clearInterval(gameTimer);
      if (gameTime > 0) {
        gameTimer = setInterval(() => {
          gameSeconds--;
          gameTimeDisplay.textContent = formatTime(gameSeconds);
          if (gameSeconds <= 0) {
            clearInterval(gameTimer);
            clearInterval(moveTimer);
            lockBoard = true;
            showCongratulationsScreen();
          }
        }, 1000);
      }
    };

    const restartAndStart = () => {
      clearInterval(moveTimer);
      moveTimer = null;
      clearInterval(gameTimer);
      moveSeconds = moveTime;
      gameSeconds = gameTime * 60;
      moveTimeDisplay.textContent = moveTime === 0 ? "Bez czasu" : formatTime(moveSeconds);
      gameTimeDisplay.textContent = gameTime === 0 ? "Bez czasu" : formatTime(gameSeconds);
      matchedPairs = 0;
      firstCard = null;
      secondCard = null;
      lockBoard = true;
      points1 = 0;
      points2 = 0;
      currentTeam = noTeamsMode ? 1 : (startingTeam || 1);
      score1.textContent = 0;
      score2.textContent = 0;
      updateTeamHighlight();
      updateCurrentTeamDisplay();

      const labelCells = document.querySelectorAll(".label-cell");
      labelCells.forEach(el => el.classList.add("ukryj-oznakowanie"));

      const cards = document.querySelectorAll(".card");
      if (cards.length === 0) {
        console.warn("No cards found for animation");
        createBoard(true);
        lockBoard = false;
        if (started) {
          if (!noTeamsMode) startMoveTimer();
          startGameTimer();
        }
        return;
      }

      const gridRect = fullGrid.getBoundingClientRect();
      const centerX = gridRect.left + gridRect.width / 2;
      const centerY = gridRect.top + gridRect.height / 2;

      cards.forEach(card => {
        const rect = card.getBoundingClientRect();
        const offsetX = centerX - (rect.left + rect.width / 2);
        const offsetY = centerY - (rect.top + rect.height / 2);
        card.style.transition = "transform 0.5s ease-in-out";
        card.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
      });

      setTimeout(() => {
        createBoard(true);
        lockBoard = false;
        if (started) {
          if (!noTeamsMode) startMoveTimer();
          startGameTimer();
        }

        const newCards = Array.from(document.querySelectorAll(".card"));
        const newGridRect = fullGrid.getBoundingClientRect();
        const centerX = newGridRect.left + newGridRect.width / 2;
        const centerY = newGridRect.top + newGridRect.height / 2;

        newCards.forEach(card => {
          const rect = card.getBoundingClientRect();
          const offsetX = centerX - (rect.left + rect.width / 2);
          const offsetY = centerY - (rect.top + rect.height / 2);
          card.style.transition = "none";
          card.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
        });

        setTimeout(() => {
          newCards.forEach(card => {
            card.style.transition = "transform 0.6s ease-in-out";
            card.style.transform = "translate(0, 0)";
          });

          setTimeout(() => {
            newCards.forEach(card => {
              card.style.transition = "";
              card.style.transform = "";
            });

            const labelCells = document.querySelectorAll(".label-cell");
            requestAnimationFrame(() => {
              labelCells.forEach(el => el.classList.remove("ukryj-oznakowanie"));
            });
          }, 600);
        }, 30);
      }, 600);
    };

    // Przełączanie ekranów
    const showConfigScreen = () => {
      configScreen.style.display = "block";
      instructionsScreen.style.display = "none";
      congratulationsScreen.style.display = "none";
      gameContainer.style.display = "none";
      document.getElementById("config-buttons").style.display = "flex";
      // Resetowanie wartości konfiguracyjnych
      team1Input.value = "";
      team2Input.value = "";
      team2Input.disabled = false;
      team2Input.style.opacity = 1;
      btnTeam1.disabled = false;
      btnTeam2.disabled = false;
      btnTeam1.style.opacity = 1;
      btnTeam2.style.opacity = 1;
      moveTimeGroup.querySelectorAll("button").forEach(btn => {
        btn.disabled = false;
        btn.style.opacity = 1;
      });
      btnTeam1.classList.remove("active");
      btnTeam2.classList.remove("active");
      noTeamsBtn.classList.remove("active");
      moveTimeGroup.querySelectorAll("button").forEach(btn => btn.classList.remove("active"));
      gameTimeGroup.querySelectorAll("button").forEach(btn => btn.classList.remove("active"));
      startingTeam = null;
      moveTime = null;
      gameTime = null;
      noTeamsMode = false;
      updateButtonLabels();
    };

    const showInstructionsScreen = () => {
      configScreen.style.display = "none";
      instructionsScreen.style.display = "flex";
      congratulationsScreen.style.display = "none";
      gameContainer.style.display = "none";
      document.getElementById("config-buttons").style.display = "none";
    };

    const showCongratulationsScreen = () => {
      configScreen.style.display = "none";
      instructionsScreen.style.display = "none";
      congratulationsScreen.style.display = "flex";
      gameContainer.style.display = "none";
      document.getElementById("config-buttons").style.display = "none";

      const winnerTeam = noTeamsMode ? 1 : (points1 >= points2 ? 1 : 2);
      const winnerName = winnerTeam === 1 ? team1Name : team2Name;
      const winnerPoints = winnerTeam === 1 ? points1 : points2;
      const displayName = winnerName.trim() === "" || winnerName === "Drużyna 1" || winnerName === "Drużyna 2" ? `Drużyna ${winnerTeam}` : winnerName;
      winnerText.textContent = `Wygrała ${displayName}`;
      scoreText.textContent = `Ilość zdobytych punktów: ${winnerPoints}`;

      confetti({
        particleCount: 100,
        spread: 70,
        origin: { x: 0, y: 0.6 }
      });
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { x: 1, y: 0.6 }
      });
    };

    const showGameScreen = () => {
      configScreen.style.display = "none";
      instructionsScreen.style.display = "none";
      congratulationsScreen.style.display = "none";
      gameContainer.style.display = "flex";
      document.getElementById("config-buttons").style.display = "none";

      // Inicjalizacja wartości gry
      team1Name = team1Input.value.trim() || "Drużyna 1";
      team2Name = noTeamsMode ? "" : (team2Input.value.trim() || "Drużyna 2");
      moveTime = noTeamsMode ? 0 : (moveTime || 0);
      gameTime = gameTime || 0;

      // Walidacja
      if (isNaN(moveTime) || moveTime < 0) {
        console.error("Invalid moveTime value:", moveTime);
        moveTime = 0;
      }
      if (isNaN(gameTime) || gameTime < 0) {
        console.error("Invalid gameTime value:", gameTime);
        gameTime = 0;
      }

      team1NameSpan.textContent = team1Name;
      team2NameSpan.textContent = team2Name;
      team2Label.style.display = noTeamsMode ? "none" : "flex";
      moveTimeLabel.style.display = noTeamsMode ? "none" : "flex";
      moveTimeDisplay.textContent = moveTime === 0 ? "Bez czasu" : formatTime(moveTime);
      gameTimeDisplay.textContent = gameTime === 0 ? "Bez czasu" : formatTime(gameTime * 60);
      moveSeconds = moveTime;
      gameSeconds = gameTime * 60;
      currentTeam = noTeamsMode ? 1 : null;

      createBoard(false);
      updateTeamHighlight();
      updateCurrentTeamDisplay();
      const labelCells = document.querySelectorAll(".label-cell");
      requestAnimationFrame(() => {
        labelCells.forEach(el => el.classList.remove("ukryj-oznakowanie"));
      });
    };

    // Obsługa przycisków
    nextBtn.addEventListener("click", () => {
      showGameScreen();
    });

    instructionsBtn.addEventListener("click", () => {
      showInstructionsScreen();
    });

    instructionsReturnBtn.addEventListener("click", () => {
      showConfigScreen();
    });

    congratsReturnBtn.addEventListener("click", () => {
      showGameScreen();
    });

    startBtn.addEventListener("click", () => {
      if (!started) {
        currentTeam = noTeamsMode ? 1 : (startingTeam || 1);
        document.querySelectorAll(".cover").forEach(cover => cover.classList.add("kolorowa"));
        lockBoard = false;
        if (!noTeamsMode && moveTime > 0) {
          moveSeconds = moveTime;
          moveTimeDisplay.textContent = formatTime(moveSeconds);
          startMoveTimer();
        } else {
          moveTimeDisplay.textContent = "Bez czasu";
        }
        if (gameTime > 0) {
          gameSeconds = gameTime * 60;
          gameTimeDisplay.textContent = formatTime(gameSeconds);
          startGameTimer();
        } else {
          gameTimeDisplay.textContent = "Bez czasu";
        }
        startBtn.textContent = "Restart";
        started = true;
        updateTeamHighlight();
        updateCurrentTeamDisplay();
      } else {
        restartAndStart();
      }
    });

    const toggleFullscreen = () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    };

    configFullscreenBtn.addEventListener("click", toggleFullscreen);
    fullscreenBtn.addEventListener("click", toggleFullscreen);

    document.addEventListener("fullscreenchange", () => {
      if (document.fullscreenElement) {
        fullscreenBtn.textContent = "Podstawowy ekran";
        configFullscreenBtn.textContent = "Podstawowy ekran";
        document.body.classList.add("fullscreen-active");
      } else {
        fullscreenBtn.textContent = "Pełny ekran";
        configFullscreenBtn.textContent = "Pełny ekran";
        document.body.classList.remove("fullscreen-active");
      }
    });

    returnBtn.addEventListener("click", () => {
      clearInterval(moveTimer);
      moveTimer = null;
      clearInterval(gameTimer);
      started = false;
      startBtn.textContent = "Start";
      document.querySelectorAll(".cover").forEach(cover => cover.classList.remove("kolorowa"));
      showConfigScreen();
    });

    // Inicjalizacja
    updateButtonLabels();
    configScreen.style.display = "block";
    instructionsScreen.style.display = "none";
    congratulationsScreen.style.display = "none";
    gameContainer.style.display = "none";
    document.getElementById("config-buttons").style.display = "flex";
  </script>
</body>
</html>
